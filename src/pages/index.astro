---
import { getCollection } from "astro:content";
import SimpleCard from "../components/SimpleCard.astro";
import ProjectSocialLinks from "../components/SocialLink/ProjectSocialLinks.astro";
import { BLOGS, HOME, SIDE_PROJECTS, WORK_EXPERIENCE } from "../consts";
import Page from "../layouts/Page.astro";
import { dateRange } from "../lib/utils";

const numberOfStuffShown = 3;

const workExperiencesCollection = await getCollection("work-experience");
const workExperiences = await Promise.all(
  workExperiencesCollection
    .map(async (experience) => {
      const { Content } = await experience.render();
      return {
        ...experience.data,
        Content,
      };
    })
    .slice(0, numberOfStuffShown)
);

const projectsCollection = await getCollection("projects");
const projects = projectsCollection
  .map((project) => project.data)
  .sort((a, b) => {
    return b.lastUpdated.valueOf() - a.lastUpdated.valueOf();
  })
  .slice(0, numberOfStuffShown);
---

<Page page={HOME}>
  <section>
    <h3>
      Hi wanderers! <img
        class="w- h-8 inline-block align-sub"
        alt="a green frog with big eyes and a smile"
        title="yay frog random"
        loading="lazy"
        src="yay-frog.gif"
      />
    </h3>
    <p>
      I'm <em class="large">Ke</em>, <em class="large">David</em>. I build
      things at Canva. Outside of work, I like learning new things and doing
      random projects too since it's just fun fun.
    </p>
    <p>
      I also enjoy a few hobbies, like playing futsal, reading, photography,
      skating, and more.
    </p>
  </section>

  <section>
    <div class="flex flex-wrap items-center justify-between">
      <h4>Recent posts</h4>
      <a href={BLOGS.url} class="hover:animate-bounce">See all</a>
    </div>
  </section>

  <section class="space-y-4">
    <div class="flex flex-wrap items-center justify-between">
      <h4>Work experiences</h4>
      <a href={WORK_EXPERIENCE.url} class="hover:animate-bounce">See all</a>
    </div>
    <ul class="noDiscList">
      {
        workExperiences.map((workExperience) => (
          <li>
            <p class="text-sm opacity-75">
              {dateRange(workExperience.dateStart, workExperience.dateEnd)}
            </p>
            <p class="font-semibold text-foreground">
              {workExperience.company}
            </p>
            <p class="text-sm opacity-75">{workExperience.role}</p>
            <blockquote class="mt-2">{workExperience.summary}</blockquote>
          </li>
        ))
      }
    </ul>
  </section>

  <section>
    <div class="flex flex-wrap items-center justify-between">
      <h4>Side Projects</h4>
      <a href={SIDE_PROJECTS.url} class="hover:text-fore">See all</a>
    </div>
    <ul class="noDiscList">
      {
        projects.map((project) => (
          <SimpleCard title={project.title} description={project.description}>
            <ProjectSocialLinks
              title={project.title}
              blogUrl={undefined}
              demoUrl={project.demoUrl}
              repoUrl={project.repoUrl}
              slot="card-footer"
            />
          </SimpleCard>
        ))
      }
    </ul>
  </section>
</Page>
